tags: #maquina #writeups

---
Pre requisitos:
- Montamos la maquina con el modo de red de adaptador solo anfitrión
- En la maquina atacante añadiremos la ip de la maquina victima al archivo /etc/host asociándolo con ucjc y ucjc.com cuando descubramos la ip al realizar el escaneo.

Empezamos la maquina realizando un escaneo de la red para descubrir la ip de la maquina victima para ello usaremos la herramienta **netdiscover** 
![[Pasted image 20241228134351.png]]
Al terminar el escaneo obtenemos una lista de los dispositivos de la red, identificando uno de ellos como la maquina victima

![[Pasted image 20241228134517.png]]
en este caso la ip victima es 192.168.56.103
Una vez identificada la maquina victima procedemos a realizar un escaneo de los puertos abiertos con la herramienta **nmap** 

![[Pasted image 20241228134922.png]]

Con este escaneo descubrimos los siguientes puertos abiertos
![[Pasted image 20241228135016.png]]
Apreciamos que solo los puertos 22 y 80 esta abiertos a priori, seguimos con el descubrimiento de esos puertos a ver si encontramos algo interesante sino buscaremos mas puertos por UDP o puertos filtrados.

Continuamos con un escaneo mas profundo lanzando con nmap un conjunto básico de scrips de reconocimiento para averiguar servicios y versiones de los puertos descubiertos.

![[Pasted image 20241228135634.png]]
Una vez descubiertas las versiones de los servicios de los puertos 22 y 80 procedemos a buscar si existe algún exploit. 



(se encuentra una injeccion remota de comandos en el index.php y realizamos una revert shell conel siguiente comando con el cual nos autenticamos como www-data)
```
ucjc.com/index.php?page=indexD
```


(documentar escaneo con dirb, se encuentra una ruta a phpmyadmin, se intenta entrar sin contraseña con el usuario admin y entramos)

(navegando por la web encontramos un usuario que postea en el foro, intentamos un ataque con hydra con ese usuario y conseguimos su clave usando el diccionario rockyou)
![[Pasted image 20241229104853.png]]
conectamos sin problemas
![[Pasted image 20241229105943.png]]
Tras la conexion ssh observamos que el usuario tiene permiso para ejecutar un archivo .sh con privilegios elevados, ejecutamos ese fichero con
```bash
sudo ht
```
pero falla la apertura al necesitar una XTERM.
Observamos que existe otro fichero donde podemos ver los comandos ejecutados por el usuario anteriormente y ahi odemos ver que soluciona el problema ejecutando antes
```
TERM=xterm
```
ahora si volvemos a ejecutar el comando sudo ht y entramos en un programa de visualización y edición de ficheros.
(documentar con imagenes el proceso de escalada de privilegios mediante este programa)
al pulsar F2 nos abre una ventana donde podemos ver las rutas de archivos y en el historial vemos un fichero interesante /etc/sudoers
En este fichero modificamos para que el usuario que usamos pueda usar el comando sudo sin restriccion.
ahora ejecutamos 
```bash
sudo su
```
con el que introduciendo la contraseña del usuario actual nos convertimos en root
![[Pasted image 20241229113012.png]]
